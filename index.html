<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>
    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
  </script>
  <script>
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    var roomId = getParameterByName('id');

    if (roomId == null) {
      socket.emit('connectToRoom');
    }
    else {
      socket.emit('connectToRoom', { roomId: roomId });
    }

    socket.on('newConnection', function (data) {
      console.log(data.message);
      window.history.pushState({}, 'Collab', '/?id=' + data.roomId);
      roomId = data.roomId;
    });

    socket.on('codeUpdate', function (data) {
      $('#temp').val(data.code)
    });

    $(document).ready(function () {
      $('#temp').bind('input propertychanged', function () {
        socket.emit('codeChange', { code: $(this).val(), roomId: roomId });
      })
    });
  </script>
</head>

<body>
  <textarea id='temp'></textarea>
</body>

</html>